"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_rollupPluginBabelHelpers-7d3a169b.js"),n=require("react"),r=require("file-selector");function t(t){var l=t.accept,i=void 0===l?"*":l,o=t.multiple,c=void 0===o||o,a=t.readAs,u=void 0===a?"Text":a,s=t.readFilesContent,f=void 0===s||s,d=t.validators,p=void 0===d?[]:d,v=t.initializeWithCustomParameters,m=t.directory,F=void 0!==m&&m,y=n.useState([]),h=y[0],C=y[1],S=n.useState([]),x=S[0],b=S[1],g=n.useState([]),k=g[0],_=g[1],R=n.useState(!1),P=R[0],E=R[1],w=function(e){var n=e.onFilesSelected,r=e.onFilesSuccessfullySelected,t=e.onFilesRejected,l=e.onClear,i=e.validators;return{onFilesSelected:function(e){null==n||n(e),null==i||i.forEach((function(n){n.onFilesSelected(e)}))},onFilesSuccessfullySelected:function(e){null==r||r(e),null==i||i.forEach((function(n){n.onFilesSuccessfullySelected(e)}))},onFilesRejected:function(e){null==t||t(e),null==i||i.forEach((function(n){n.onFilesRejected(e)}))},onClear:function(){null==l||l(),null==i||i.forEach((function(e){null==e.onClear||e.onClear()}))}}}(t),j=w.onFilesSelected,A=w.onFilesSuccessfullySelected,B=w.onFilesRejected,M=w.onClear,T=n.useCallback((function(){C([]),b([]),_([])}),[]),q=n.useCallback((function(){T(),null==M||M()}),[T,M]),G=function(n){return new Promise(function(){var r=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(l,i){var o,c;return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:(o=new FileReader)["readAs"+u].call(o,n),c=function(n){var r=e._extends({},(e._objectDestructuringEmpty(n),n));i(e._extends({},r))},o.onload=e._asyncToGenerator(e._regeneratorRuntime().mark((function r(){return e._regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.all(p.map((function(e){return e.validateAfterParsing(t,n,o).catch((function(e){return Promise.reject(c(e))}))}))).then((function(){return l(e._extends({},n,{content:o.result,name:n.name,lastModified:n.lastModified}))})).catch((function(){})));case 1:case"end":return r.stop()}}),r)}))),o.onerror=function(){c({name:"FileReaderError",readerError:o.error,causedByFile:n})};case 6:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}())};return{openFilePicker:function(n){!function(e,n,r,t,l){var i=document.createElement("input");i.style.display="none",document.body.appendChild(i),i.type="file",r&&(i.webkitdirectory=!0),"*"!==e&&(i.accept=e),i.multiple=n,i.addEventListener("change",(function(e){t(e),document.body.removeChild(i)})),l&&l(i),i.dispatchEvent(new MouseEvent("click"))}(i instanceof Array?i.join(","):i,void 0!==(null==n?void 0:n.multiple)?n.multiple:c,void 0!==(null==n?void 0:n.directory)?n.directory:F,function(){var n=e._asyncToGenerator(e._regeneratorRuntime().mark((function n(l){var i,o,c,a,u,s;return e._regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(),o=(i=l.target).files?Array.from(i.files):[],E(!0),e.next=6,Promise.all(p.map((function(e){return e.validateBeforeParsing(t,o).catch((function(e){return Array.isArray(e)?e:[e]}))})));case 6:if(c=e.sent.flat(1).filter(Boolean),C(o),_(c),!c.length){e.next=15;break}return E(!1),C([]),null==B||B({errors:c}),null==j||j({errors:c}),e.abrupt("return");case 15:if(f){e.next=19;break}return E(!1),null==j||j({plainFiles:o,filesContent:[]}),e.abrupt("return");case 19:return e.next=21,r.fromEvent(l);case 21:return a=e.sent,u=[],e.next=25,Promise.all(a.map((function(e){return G(e).catch((function(e){u.push.apply(u,Array.isArray(e)?e:[e])}))})));case 25:if(s=e.sent,E(!1),!u.length){e.next=34;break}return C([]),b([]),_((function(e){return[].concat(e,u)})),null==B||B({errors:u}),null==j||j({errors:c.concat(u)}),e.abrupt("return");case 34:b(s),C(o),_([]),null==A||A({filesContent:s,plainFiles:o}),null==j||j({plainFiles:o,filesContent:s});case 39:case"end":return e.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),v)},filesContent:x,errors:k,loading:P,plainFiles:h,clear:q}}exports.useFilePicker=t,exports.useImperativeFilePicker=function(r){var l=r.onFilesSelected,i=r.onFilesSuccessfullySelected,o=r.validators,c=r.onFileRemoved,a=n.useState([]),u=a[0],s=a[1],f=n.useState([]),d=f[0],p=f[1],v=t(e._extends({},r,{onFilesSelected:function(e){var n;if(l)return null!=(n=e.errors)&&n.length?l(e):void l({errors:void 0,plainFiles:[].concat(u,e.plainFiles||[]),filesContent:[].concat(d,e.filesContent||[])})},onFilesSuccessfullySelected:function(e){s((function(n){return n.concat(e.plainFiles)})),p((function(n){return n.concat(e.filesContent)})),i&&i({plainFiles:[].concat(u,e.plainFiles||[]),filesContent:[].concat(d,e.filesContent||[])})}})),m=v.openFilePicker,F=v.loading,y=v.errors,h=v.clear,C=n.useCallback((function(){h(),s([]),p([])}),[h]),S=n.useCallback((function(e){p((function(n){return[].concat(n.slice(0,e),n.slice(e+1))})),s((function(n){var r=n[e];return null==o||o.forEach((function(n){return null==n.onFileRemoved?void 0:n.onFileRemoved(r,e)})),null==c||c(r,e),[].concat(n.slice(0,e),n.slice(e+1))}))}),[o,c]),x=n.useCallback((function(e){var n=u.findIndex((function(n){return n===e}));-1!==n&&S(n)}),[S,u]);return{openFilePicker:m,plainFiles:u,filesContent:d,loading:F,errors:y,clear:C,removeFileByIndex:S,removeFileByReference:x}};
//# sourceMappingURL=index.cjs.production.min.js.map
